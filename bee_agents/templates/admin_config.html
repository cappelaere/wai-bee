<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Configuration - Scholarship Management System</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ†Ô∏è Admin Configuration</h1>
            <p>View scholarship configuration (read-only)</p>
        </div>

        <div class="content">
            <div class="section">
                <h2>üéì Select Scholarship</h2>
                <p>Choose a scholarship to view:</p>
                <select id="scholarshipSelect" style="padding: 8px; min-width: 260px;">
                    <option value="">Loading scholarships...</option>
                </select>
                <span id="scholarshipStatus" style="margin-left: 10px; color: #666;"></span>
            </div>

            <div class="section">
                <h2>üìã Scholarship Configuration</h2>
                <p>View the current scholarship and agent configuration. To modify, edit <code>config.yml</code> and run <code>generate_artifacts.py</code>.</p>
                <div id="configContainer" class="api-section">
                    <p style="color:#666;">Select a scholarship to view configuration.</p>
                </div>
            </div>

            <div class="section">
                <h2>ü§ñ Agent Configuration</h2>
                <p>View enabled agents and their scoring weights.</p>
                <div id="agentsContainer" class="api-section">
                    <p style="color:#666;">Select a scholarship to view agents.</p>
                </div>
            </div>

        </div>

        <div class="footer">
            <p>Admin Configuration | Scholarship Management System</p>
        </div>
    </div>

    <script>
        const scholarshipSelect = document.getElementById('scholarshipSelect');
        const scholarshipStatus = document.getElementById('scholarshipStatus');
        const configContainer = document.getElementById('configContainer');
        const agentsContainer = document.getElementById('agentsContainer');

        async function loadScholarships() {
            try {
                const resp = await fetch('/api/user/scholarships', { credentials: 'include' });
                if (!resp.ok) throw new Error('Failed to load scholarships');
                const scholarships = await resp.json();

                scholarshipSelect.innerHTML = '<option value="">Select scholarship...</option>';
                scholarships.forEach(s => {
                    const opt = document.createElement('option');
                    opt.value = s.id;
                    opt.textContent = s.name;
                    scholarshipSelect.appendChild(opt);
                });

                scholarshipStatus.textContent = '';
            } catch (e) {
                console.error(e);
                scholarshipSelect.innerHTML = '<option value="">Error loading scholarships</option>';
                scholarshipStatus.textContent = 'Failed to load scholarships';
            }
        }

        async function loadConfig(scholarship) {
            if (!scholarship) {
                configContainer.innerHTML = '<p style="color:#666;">Select a scholarship to view configuration.</p>';
                return;
            }
            try {
                const resp = await fetch(`/admin/${encodeURIComponent(scholarship)}/scholarship`);
                if (!resp.ok) throw new Error('Failed to load scholarship config');
                const data = await resp.json();

                configContainer.innerHTML = `
                    <table style="width:100%; border-collapse:collapse;">
                        <tr><td style="padding:4px 8px;"><strong>ID:</strong></td><td>${data.scholarship_id || 'N/A'}</td></tr>
                        <tr><td style="padding:4px 8px;"><strong>Version:</strong></td><td>${data.version || 'N/A'}</td></tr>
                        <tr><td style="padding:4px 8px;"><strong>Status:</strong></td><td>${data.status || 'N/A'}</td></tr>
                        <tr><td style="padding:4px 8px;"><strong>Intent:</strong></td><td>${data.intent || 'N/A'}</td></tr>
                    </table>
                    <details style="margin-top:12px;">
                        <summary style="cursor:pointer; color:#667eea;">View full JSON</summary>
                        <pre style="background:#f5f5f5; padding:12px; border-radius:4px; overflow:auto; max-height:300px; font-size:12px;">${JSON.stringify(data, null, 2)}</pre>
                    </details>
                `;
            } catch (e) {
                console.error(e);
                configContainer.innerHTML = '<p style="color:#c00;">Failed to load configuration.</p>';
            }
        }

        async function loadAgents(scholarship) {
            if (!scholarship) {
                agentsContainer.innerHTML = '<p style="color:#666;">Select a scholarship to view agents.</p>';
                return;
            }
            try {
                const resp = await fetch(`/admin/${encodeURIComponent(scholarship)}/agents`);
                if (!resp.ok) throw new Error('Failed to load agents config');
                const data = await resp.json();

                const rows = (data.agents || []).map(agent => `
                    <tr>
                        <td style="padding:6px 8px;">${agent.name}</td>
                        <td style="padding:6px 8px;">${agent.display_name}</td>
                        <td style="padding:6px 8px; text-align:center;">${agent.weight !== null ? agent.weight.toFixed(2) : '-'}</td>
                        <td style="padding:6px 8px; text-align:center;">${agent.enabled ? '‚úÖ' : '‚ùå'}</td>
                        <td style="padding:6px 8px;">${(agent.evaluates || []).join(', ') || '-'}</td>
                    </tr>
                `).join('');

                agentsContainer.innerHTML = `
                    <table style="width:100%; border-collapse:collapse;">
                        <thead>
                            <tr style="background:#f5f5f5;">
                                <th style="text-align:left; padding:8px;">Name</th>
                                <th style="text-align:left; padding:8px;">Display Name</th>
                                <th style="text-align:center; padding:8px;">Weight</th>
                                <th style="text-align:center; padding:8px;">Enabled</th>
                                <th style="text-align:left; padding:8px;">Evaluates</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${rows}
                        </tbody>
                    </table>
                    <p style="margin-top:12px; color:#666;">
                        <strong>Scoring Agents:</strong> ${(data.scoring_agents || []).join(', ')} | 
                        <strong>Total Weight:</strong> ${data.total_weight || 0}
                    </p>
                `;
            } catch (e) {
                console.error(e);
                agentsContainer.innerHTML = '<p style="color:#c00;">Failed to load agents.</p>';
            }
        }

        scholarshipSelect.addEventListener('change', () => {
            const sch = scholarshipSelect.value;
            scholarshipStatus.textContent = sch ? `Selected: ${sch}` : '';
            loadConfig(sch);
            loadAgents(sch);
        });

        // Initialize
        loadScholarships();
    </script>
</body>
</html>
